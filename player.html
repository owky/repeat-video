<!DOCTYPE html>
<meta lang='ja'>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Repeat YouTube Video</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">
  <script src="https://kit.fontawesome.com/91b57af349.js" crossorigin="anonymous"></script>
</head>

<body>
  <nav class="navbar is-black">
    <div class="navbar-brand">
      <div class="navbar-item">
	My YouTube Player
      </div>
    </div>
    <div class="navbar-menu">
      <div class="navbar-start">
	<div class="navbar-item">
	  <input type="text" id="video_id" value="" placeholder="zQhoI1FqUdM">
	  <button onclick="changeVideo()">Play!</button>
	</div>
	<div class="navbar-item">
	  https://www.youtube.com/watch?v=<font color="red">zQhoI1FqUdM</font>
	</div>
      </div>
      <div class="navbar-end">
	<div class="navbar-item">
	  <a class="button is-light is-small" href="javascript:url=location.href;var reg=new RegExp(/https:\/\/www\.youtube\.com\/watch\?v=([^&]+)/);url.match(reg)?location.href='http://192.168.11.60:8080/player.html?vid='+url.match(reg)[1]:alert('Youtube video is not found.');">Bookmarklet</a>
	</div>
      </div>
    </div>
  </nav>

  <section class="section">
  <div class="columns">
    <div class="column is-narrow">
      <div id="player"></div>
    </div>

    <div class="column">

      <div class="box has-text-centered">
	<div>
	  <p class="heading">Back to top</p>
	  <span class="icon" onclick="backToTop()">
	    <i class="fas fa-2x fa-step-backward"></i>
	  </span>
	</div>
      </div>

      <div class="box">
	<div class="columns is-vcentered is-multiline is-mobile has-text-centered">
	  <div class="column is-6">
	    <div>
	      <p class="heading">Speed</p>
	      <p class="title">
		x <span id="speed">1.0</span>
	      </p>
	    </div>
	  </div>
	  <div class="column is-3">
	    <p class="heading">down</p>
	    <span class="icon" onclick="speedDown()">
	      <i class="fas fa-4x fa-caret-down"></i>
	    </span>
	  </div>
	  <div class="column is-3">
	    <p class="heading">up</p>
	    <span class="icon" onclick="speedUp()">
	      <i class="fas fa-4x fa-caret-up"></i>
	    </span>
	  </div>
	  <div class="column is-12">
	    <input id="speedSlider" type="range" value="100" step="10" oninput="changeSpeed()">
	  </div>
	</div>
      </div>

    </div>
  </div>
</section>

  <script>
    var video_id = 'HhZW-XZShhs';
    if (location.search.match(/\?vid=.+/)) {
	video_id = location.search.split('?')[1].split('&')[0].split('=')[1];
    }

    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    var player;
    function onYouTubeIframeAPIReady() {
	player = new YT.Player('player', {
	    videoId: video_id,
	    events: {}
	});
    }
    function backToTop () {
	player.seekTo(0);
    }
    function changeVideo () {
	player.loadVideoById(document.getElementById("video_id").value)
    }
    function changeSpeed () {
	speed = document.getElementById("speedSlider").value / 100;
	document.getElementById("speed").innerHTML = speed.toFixed(1);
	player.setPlaybackRate(speed);
    }
    function speedUp () {
	document.getElementById("speedSlider").stepUp();
	changeSpeed();
    }
    function speedDown () {
	document.getElementById("speedSlider").stepDown();
	changeSpeed();
    }
  </script>
  
</body>
</html>
